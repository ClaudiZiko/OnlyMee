<script>
    let API_KEY = 'AIzaSyA17oe-L1_bNLxCzGf1HMrMIWa6sD0gCG0';  // Ganti dengan API key yang valid
    let FOLDER_ID = '16pF80Akm48g53eWJaLz9nQYdJCS819lU';  // ID Folder yang benar

    function loadClient() {
        gapi.client.setApiKey(API_KEY);
        return gapi.client.load("https://content.googleapis.com/discovery/v1/apis/drive/v3/rest")
            .then(function () {
                console.log("GAPI client loaded for API");
                listFiles();  // Panggil fungsi untuk mengambil daftar file
            }, function (error) {
                console.error("Error loading GAPI client", error);
            });
    }

    function listFiles() {
        gapi.client.drive.files.list({
            q: `'${FOLDER_ID}' in parents and mimeType contains 'audio'`,
            fields: 'files(id, name)',
        }).then(function (response) {
            let files = response.result.files;
            if (files && files.length > 0) {
                console.log("Files found:", files);
                createPlaylist(files);
            } else {
                console.log("No files found.");
            }
        });
    }

    function createPlaylist(files) {
        let playlist = document.getElementById('playlist');
        playlist.innerHTML = '';  
        files.forEach(function (file) {
            let li = document.createElement('li');
            li.textContent = file.name;
            li.onclick = function () {
                loadMusic(`https://drive.google.com/uc?export=download&id=${file.id}`);
            };
            playlist.appendChild(li);
        });
    }

    function loadMusic(url) {
        let player = document.getElementById('audioPlayer');
        let source = document.getElementById('audioSource');
        source.src = url;
        player.load();
        player.play();
    }

    gapi.load("client", loadClient);
</script>